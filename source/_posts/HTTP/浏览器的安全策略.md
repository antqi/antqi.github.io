HTTP和Web安全模型--[同源策略](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy)是互不相关的。事实上，当前的Web安全模型是在HTTP被创造出来后才被发展的。

## 关于同域策略

> 不允许浏览器访问跨域的Cookie，ajax请求跨域接口等。同源组成：**协议**，**主机名**，**端口**

同域策略是浏览器的限制，不是服务器限制。服务器会正常的接受和响应来自不同域的请求响应。但浏览器在识别响应头，发现不是同域则会忽略内容并且抛出不是跨域的错误

``` javascript
Access to XMLHttpRequest at 'http://127.0.0.1:10000/' from origin 'http://localhost:9999' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

## 跨域限制-预请求

> “需预检的请求”要求必须首先使用 [`OPTIONS`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/OPTIONS)  方法发起一个预检请求到服务器，以获知服务器是否允许该实际请求。"预检请求“的使用，可以避免跨域请求对服务器的用户数据产生未预期的影响。

### 不会出发预请求的情况

- 请求方法
  - GET
  - HEAD
  - POST
- [非用户代理自动设置的首部字段](https://fetch.spec.whatwg.org/#forbidden-header-name)
- 以下三种Content-Type 类型
  - `text/plain`
  - `multipart/form-data`
  - `application/x-www-form-urlencoded`
- 请求中的任意[`XMLHttpRequestUpload`](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload) 对象均没有注册任何事件监听器；[`XMLHttpRequestUpload`](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload) 对象可以使用 [`XMLHttpRequest.upload`](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/upload) 属性访问。
- 请求中没有使用 [`ReadableStream`](https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream) 对象。

### 预请求的几个部首字段

- Access-Control-Allow-Methods

  表明服务器允许客户端使用的方法发起请求

  ``` HTTP
  Access-Control-Allow-Methods: PUT
  Access-Control-Allow-Origin: http://localhost:9999
  Connection: keep-alive
  Date: Wed, 10 Jun 2020 06:58:19 GMT
  Transfer-Encoding: chunked
  ```

- Access-Control-Allow-Headers

  表明服务器允许请求中携带的头部字段

  ``` http
  Access-Control-Allow-Headers: X-TEST-CORS
  Access-Control-Allow-Methods: PUT
  Access-Control-Allow-Origin: http://localhost:9999
  Connection: keep-alive
  Date: Wed, 10 Jun 2020 07:01:47 GMT
  Transfer-Encoding: chunked
  ```

- Access-Control-Max-Age

  在有效时间内，浏览器无需为同一请求再发起预检请求（减少请求次数）

  ``` http
  Access-Control-Allow-Headers: X-TEST-CORS
  Access-Control-Allow-Methods: PUT
  Access-Control-Allow-Origin: http://localhost:9999
  Access-Control-Max-Age: 1000
  Connection: keep-alive
  Date: Wed, 10 Jun 2020 07:05:16 GMT
  Transfer-Encoding: chunked
  ```

  